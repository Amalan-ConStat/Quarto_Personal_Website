{
  "hash": "3433a856e263404e28b854fdc7f9cd0a",
  "result": {
    "markdown": "---\ntitle: 'Week 9 : French Train Delays'\ndate: '2019-02-28'\ncategories:\n  - TidyTuesday\n  - 2019\nimage: featured.png\ndraft: false\nnumber-sections: false\nformat:\n  html:\n    fig-cap-location: bottom\nresources: \n  - \"featured.png\"\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load the packages\nlibrary(readr)\nlibrary(tidyverse)\nlibrary(gganimate)\nlibrary(ggalluvial)\nlibrary(geomnet)\nlibrary(ggthemr)\n\n# load the theme\nggthemr(\"fresh\")\n\n# load the data\nsmall_trains <- read_csv(\"small_trains.csv\")\n```\n:::\n\n\n[GitHub Code](https://github.com/Amalan-ConStat/TidyTuesday/tree/master/2019/Week9)\n\n[Data set](https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-02-26)\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n{{% tweet \"1101039210298003456\" %}}\n```\n:::\n:::\n\n\n# Network Graph for the French City Trains\n\nSimply drawing a network graph to understand which french cities are mainly urban with \ncapacity to trains arriving and leaving. Cities such as Paris Lyon, Paris Montparnasse,\nParis Nord and Paris Est could be cities of concern with much for traffic with related to trains.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(small_trains,aes(from_id=departure_station,to_id=arrival_station))+\n          geom_net(directed = TRUE,labelon = TRUE,size=0.5,labelcolour = \"black\",\n                   repel = FALSE,ecolour = \"grey70\", arrowsize = 0.75,\n                   linewidth = 0.5,layout.alg = \"fruchtermanreingold\")+\n          theme_net()+\n          ggtitle(\"Network Graph Showing from City to City of French Trains\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/network graph-1.png){width=1344}\n:::\n:::\n\n\n# Paris Montparnasse\n\nLet me focus on Montparnasse which has lot of trains coming towards and leaving outwards\naccording to the network map. Not all are cities of France according to my observations, where\nI can see Madrid, Zurich and Barcelona. \n\n## Chosen City with Total Number of Trips\n\nTotal number of trips from Paris Montparnasse station to other cities is noted here.\nFour years of data with more accuracy by months is considered in this plot.\nThere is clear variation in this data for cities. \n\nClose to 800 trips have been recorded towards the Bordeaux St Jean city but not clearly the same\npattern for all years or months as well. Further, St Malo city has the lowest amount of trips\ncompared to other cities in all fours but follows a centered pattern around the 100 mark.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(subset(small_trains,departure_station==\"PARIS MONTPARNASSE\"),\n       aes(x=str_wrap(arrival_station,20),y=total_num_trips,color=month))+\n       geom_jitter()+coord_flip()+ labs(color=\"Month\")+\n       transition_time(year)+ease_aes(\"linear\")+\n       scale_y_continuous(breaks = seq(0,800,100),labels=seq(0,800,100))+\n       xlab(\"Arrival Station\")+ylab(\"Total Number of Trips\")+\n       ggtitle(\"Paris Montparnasse and its arrival Stations\" ,subtitle =\"Year :{frame_time}\")\n\nanimate(p,nframes=4,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Paris Montparnasse total num of trips-1.gif)\n:::\n:::\n\n\n## Chosen City with Average Journey Time\n\nExcept year 2017 all cities has similar and centered data points. In this exceptional\nyear of 2017 we can see a difference between the first six months and rest. Where most \nof the Average journey times have been reduced, it is clear according to year 2018 points.\n\nCity of Toulouse Matabiau has the highest Average Journey Time, while lowest time goes to the city \nof Le Mans. So what happened after mid of year 2017.\n\nMaximum Average Journey time before mid of year 2017 is close to 325 but after this period \nit is centered around 275. The Minimum Average Journey time before mid of year\n2017 and after also it is close to 50. \n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(subset(small_trains,departure_station==\"PARIS MONTPARNASSE\"),\n       aes(x=str_wrap(arrival_station,20),y=journey_time_avg,color=month))+\n       geom_jitter()+coord_flip()+ labs(color=\"Month\")+\n       transition_time(year)+ease_aes(\"linear\")+\n       scale_y_continuous(breaks=seq(0,350,25),labels=seq(0,350,25))+\n       xlab(\"Arrival Station\")+ylab(\"Average Journey Time\")+\n       ggtitle(\"Paris Montparnasse and its arrival Station\" ,subtitle =\"Year :{frame_time}\")\n\nanimate(p,nframes=4,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Paris Montparnasse Journey time average-1.gif)\n:::\n:::\n\n\n## Chosen City with Average Delay with All Departing\n\nThere is no clear pattern in perspective of months or years because data points are spread\nall over the place. Yet there is an odd occurring of negative values for average delay with all\ndeparting for some cities after mid of year 2017. \n\nWell none of these negative values does not exceed -2.5, where the maximum average delay in \nall departing is close to 5.5. I believe unit measured is in minutes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(subset(small_trains,departure_station==\"PARIS MONTPARNASSE\"),\n       aes(x=str_wrap(arrival_station,20),y= avg_delay_all_departing,color=month))+\n       geom_jitter()+coord_flip()+ labs(color=\"Month\")+\n       scale_y_continuous(breaks=seq(-2.5,5.5,0.5),labels=seq(-2.5,5.5,0.5))+\n       transition_time(year)+ease_aes(\"linear\")+\n       geom_hline(yintercept = 0,color=\"red\")+\n       xlab(\"Arrival Station\")+ylab(\"Average Delay All Departing\")+\n       ggtitle(\"Paris Montparnasse and its arrival Station\" ,subtitle =\"Year :{frame_time}\")\n\nanimate(p,nframes=4,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Paris Montparnasse avg delay all departing-1.gif)\n:::\n:::\n\n\n## Chosen City with Average Delay with All Arriving\n\nHighest delay could occur close to 18 minutes for average delay in Arriving and\nthe lowest is close to -3. only in 2018 we see such negative values. \nThese negative values occurs for the city of St Malo. Also there is no clear\npattern in any city with relative to year or months.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(subset(small_trains,departure_station==\"PARIS MONTPARNASSE\"),\n       aes(x=str_wrap(arrival_station,20),y=avg_delay_all_arriving,color=month))+\n       geom_jitter()+coord_flip()+ labs(color=\"Month\")+\n       transition_time(year)+ease_aes(\"linear\")+\n       geom_hline(yintercept = 0,color=\"red\")+\n       scale_y_continuous(breaks=seq(-3,18),labels=seq(-3,18))+\n       xlab(\"Arrival Station\")+ylab(\"Average Delay All Arriving\")+\n       ggtitle(\"Paris Montparnasse and its arrival Station\" ,subtitle =\"Year :{frame_time}\")\n\nanimate(p,nframes=4,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Paris Montparnasse avg delay all arriving-1.gif)\n:::\n:::\n\n\n## Chosen City with Number of Late Departures\n\nNumber of Late departures over the years increases for all cities. It is more \nclear for Bordeaux St Jean where the counts go beyond 150 and close to 200 in the \nyear of 2018, but in 2015 the highest point is close to 75 for the same city. \n\nSt Malo has the lowest number of late departures where it fails to reach the count \nof 30 in all four years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(subset(small_trains,departure_station==\"PARIS MONTPARNASSE\"),\n       aes(x=str_wrap(arrival_station,20),y=num_late_at_departure,\n           color=month))+\n       geom_jitter()+coord_flip()+ labs(color=\"Month\")+\n       scale_y_continuous(breaks=seq(0,200,25),labels=seq(0,200,25))+\n       transition_time(year)+ease_aes(\"linear\")+\n       xlab(\"Arrival Station\")+ylab(\"Number of Lates at Departure\")+\n       ggtitle(\"Paris Montparnasse and its arrival Station\" ,subtitle =\"Year :{frame_time}\")\n\nanimate(p,nframes=4,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Paris Montparnasse num late at departure-1.gif)\n:::\n:::\n\n\n## Chosen City with Number of Late Arrivals\n\nCity of St Malo has the lowest amount of late arrivals for all fours in general.\nMost amount of highest late arrivals occur in the city of Bordeaux St Jean. In \nyear 2015 most of these data points are centered towards their specific values. \nIn the next few years we can see that is not the case and they are with a lot of \nvariation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(subset(small_trains,departure_station==\"PARIS MONTPARNASSE\"),\n       aes(x=str_wrap(arrival_station,20),y=num_arriving_late,\n           color=month))+\n       geom_jitter()+coord_flip()+ labs(color=\"Month\")+\n       transition_time(year)+ease_aes(\"linear\")+\n       scale_y_continuous(breaks=seq(0,200,20),labels=seq(0,200,20))+\n       xlab(\"Arrival Station\")+ylab(\"Number of Lates at Arriving\")+\n       ggtitle(\"Paris Montparnasse and its arrival Station\" ,subtitle =\"Year :{frame_time}\")\n\nanimate(p,nframes=4,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Paris Montparnasse num arriving late-1.gif)\n:::\n:::\n\n\n# Departure Station with Average Journey Time and Total Number of Trips\n\nSummary of this below plot is that when Average Journey Time increases clearly\nTotal Number of Trips will decrease. \n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(small_trains,aes(x=journey_time_avg,y=total_num_trips,color=month))+\n      geom_point()+transition_states(departure_station)+labs(color=\"Month\")+\n      ggtitle(\"Average Journey Time and Total Number of Trips\",\n              subtitle=\"Departure Station : {closest_state}\")+\n      scale_y_continuous(breaks=seq(0,900,50),labels=seq(0,900,50))+\n      scale_x_continuous(breaks=seq(0,500,50),labels=seq(0,500,50))+  \n      xlab(\"Average Journey Time\")+ylab(\"Total Number of Trips\")+\n      shadow_mark()\n\nanimate(p,nframes=59,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/departure station with journey time avg and total num trips-1.gif)\n:::\n:::\n\n\n# Departure Station with Average Delay All Departing and Number of Late at Departures\n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(small_trains,aes(x=num_late_at_departure,y=avg_delay_all_departing,\n                           color=month))+\n      geom_point()+transition_states(departure_station)+labs(color=\"Month\")+\n      ggtitle(\"Average Delay at All Departing and Number of Lates at Departure\",\n              subtitle=\"Departure Station : {closest_state}\")+\n      geom_vline(xintercept = 0,color=\"red\")+\n      geom_hline(yintercept = 0,color=\"red\")+\n      scale_y_continuous(breaks=seq(-5,175,5),labels=seq(-5,175,5))+\n      scale_x_continuous(breaks=seq(0,500,50),labels=seq(0,500,50))+  \n      xlab(\"Number of Lates at Departure\")+ylab(\"Average Delays at all Departing\")+\n      shadow_mark()\n\nanimate(p,nframes=59,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/departure station with Number of late and average Delay-1.gif)\n:::\n:::\n\n\n# Departure Station with Average Delay All Arriving and Number of Arriving Late\n\n\n::: {.cell}\n\n```{.r .cell-code}\np<-ggplot(small_trains,aes(x=num_arriving_late,y=avg_delay_all_arriving,\n                           color=month))+\n      geom_point()+transition_states(departure_station)+labs(color=\"Month\")+\n      ggtitle(\"Average Delay at All Arriving and Number of Lates at Arriving\",\n              subtitle=\"Departure Station : {closest_state}\")+\n      geom_vline(xintercept = 0,color=\"red\")+\n      geom_hline(yintercept = 0,color=\"red\")+\n      scale_y_continuous(breaks=seq(-150,40,5),labels=seq(-150,40,5))+\n      scale_x_continuous(breaks=seq(0,250,25),labels=seq(0,250,25))+  \n      xlab(\"Number of Lates at Arriving\")+ylab(\"Average Delays at all Arriving\")+\n      shadow_mark()\n\nanimate(p,nframes=59,fps=1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/departure station with Number of Arriving late and averageDelay arriving-1.gif)\n:::\n:::\n\n\n# Delayed Cause and Delayed Number \n\nDelays caused by the travelers is very less likely to happen, where most of these delays are \ncaused by external causes. Other causes such as rolling stock and rail infrastructure also has \neffect but not as much from external cause. Station management has limited amount of affect but \nhigher than travelers in causes for delaying trains.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsmall_trains %>%\n    mutate(delay_cause = str_remove(delay_cause,\"delay_cause_\")) %>%\nggplot(.,aes(x=delay_cause,y=delayed_number))+\n      xlab(\"Delay Cause\")+ylab(\"Delayed Number\")+\n      ggtitle(\"Delayed Causes and Delayed Number as percentage\")+\n      geom_jitter()+coord_flip()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Delayed No and Delayed cause-1.png){width=1152}\n:::\n:::\n\n\n*THANK YOU*\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}