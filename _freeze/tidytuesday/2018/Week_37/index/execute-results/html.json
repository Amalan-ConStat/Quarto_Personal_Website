{
  "hash": "0ddf6691f801c6da4511bebf3234e629",
  "result": {
    "markdown": "---\ntitle: 'Week 37: NYC Restaurants'\ndate: '2018-12-13'\ncategories:\n  - TidyTuesday\n  - 2018\nimage: featured.png\ndraft: false\nnumber-sections: false\nformat:\n  html:\n    fig-cap-location: bottom\nresources: \n  - \"featured.png\"\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load the packages\nlibrary(readr)\nlibrary(tidyverse)\nlibrary(magrittr)\nlibrary(ggthemr)\nlibrary(lubridate)\nlibrary(stringr)\nlibrary(kableExtra)\n\n#using theme\nggthemr(\"fresh\")\n\n#load data\nNYC<-read_csv(\"nyc_restaurants.csv\", \n    col_types = cols(inspection_date = \n                       col_date(format = \"%m/%d/%Y\")))\nattach(NYC)\n```\n:::\n\n\nData set is completed with more than 300000 records and several important variables such as inspection date,\nviolation code, critical flag, score and violation description. In this article I will mainly focus on Inspection \nType, boro, Inspection year, cuisine type and Critical Flag.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n{{% tweet \"1073204074579968000\" %}}\n```\n:::\n:::\n\n\n[GitHub Code](https://github.com/Amalan-ConStat/TidyTuesday/tree/master/Week_37)\n\nFirst see what type of inspections have occurred.\n\n# Inspection Type\n\nThis ordered bar plot for inspection type clearly indicates that cycle inspection / initial inspection \nhas the highest amount of counts with 171,657. while second place goes to cycle inspection/ re-inspection with\n73207. Other types of inspection hold less than 21,000 counts, where there are more than 10 types of inspections\nwhich hold counts less than 1000. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#summary.factor(inspection_type)  %>%\n#  sort()\n\n# Bar plot for Insepction type\nggplot(NYC,aes(x=fct_infreq(str_wrap(inspection_type,35))))+\n  geom_bar()+coord_flip()+\n  scale_y_continuous(breaks = seq(0,200000,25000),labels = seq(0,200000,25000))+\n  geom_text(stat = \"count\",aes(label=..count..),hjust=-0.005)+\n  ylab(\"Frequency\")+xlab(\"Type of Insepction\")+\n  ggtitle(\"Types of Inspection\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Inspection Type-1.png){width=1248}\n:::\n:::\n\n\n# Critical Flag\n\nCritical flag has three types of categories which are Critical, Not Critical and \nNot Applicable. It is represented as a pie chart where 54.9% are critical(164,623) \nand second place goes to Not Critical(129,348) with 43.1%. Finally, only 6029 inspections\nhave lead to Not Applicable which is represented by 2.0%.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#summary for critical flag\n#NYC$critical_flag %>%\n#      summary.factor() %>%\n#      sum()\nvalue=c(164623,6029,129348)\n\n# creating data frame for Critical flag\nCF<-data.frame(\n              group=c(\"Critical\",\"Not Applicable\",\"Not Critical\"),\n              value=c(164623,6029,129348),\n              per=round(value*100/300000,4)\n              )\n\n# pie chart for percentages\nP1<-ggplot(CF,aes(x=\"\",y=per,fill=group))+\n    geom_col()+ theme_void()+\n    geom_text(aes(label=scales::percent(per/100)),position=position_stack(vjust=0.5))+\n    labs(title = \"Critical Flag \\nDistribution\",fill=\"Type\")+\n    coord_polar(theta = \"y\",start = 0)\n\n# pie chart for counts\nP2<-ggplot(CF,aes(x=\"\",y=value,fill=group))+\n    geom_col()+theme_void()+\n    labs(title = \"Critical Flag\\n Distribution\",fill=\"Type\")+ \n    geom_text(aes(label = value), position = position_stack(vjust = 0.5)) +\n    coord_polar(theta = \"y\",start = 0)\n\ngridExtra::grid.arrange(P1,P2,nrow=2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Critical flag-1.png){width=864}\n:::\n:::\n\n\n# Inspection Type and Critical Flag over the years\n\nNow facing the issue of inspection year, inspection type and critical flag, I \nhave generated bar plots for identifying the behavior. Basically\nwhat we have is bar plots for years from 2012 to 2018 how the counts \nof Critical flag types have changed for different paired types of inspections.\n\nInspection types considered \n\n* Cycle Inspection / Initial Inspection and Cycle Inspection / Re-inspection.\n* Pre-permit (Operational) / Initial Inspection and Pre-permit (Operational) / Re-inspection.\n* Administrative Miscellaneous / Initial Inspection and Administrative Miscellaneous / Re-inspection.\n\n## Cycle Inspection\n\nInitial Inspection is always high for all the years while assigning Critical. The years\n2012, 2013 and 2014 has very low amount of counts while the succeeding years have increasing counts.\nInitial inspection over the years from 2015 is increasing for the gap between Critical and Not Critical.\nIn 2015 the above gap is close to 4000 but by 2018 it has increased to 10000. If we consider Re-inspection\nthe gap for Critical and Not Critical is close 1000 in year 2015 but by year 2018 it is 4000. Not applicable\nis increasing over the years for both initial inspection and re-inspection, even though the amounts are in \nhundreds.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subsetting data \n# Specific insepction type, critical flag and year with bar plot \nsubset(NYC,inspection_type==\"Cycle Inspection / Initial Inspection\" |\n           inspection_type==\"Cycle Inspection / Re-inspection\") %>%\nggplot(.,mapping=aes(x=str_wrap(inspection_type,8),fill=critical_flag))+\n      geom_bar(position = \"dodge\",stat = \"count\")+\n      facet_wrap(~year(inspection_date)) +\n      xlab(\"Cycle Inspection\")+\n      ylab(\"Frequency\")+\n      ggtitle(\"Cycle Inspection over the years for Critical Flag\")+\n      labs(fill=\"Critical Flag\")+\n       geom_text(stat = \"count\",aes(label=..count..),\n                 position = position_dodge(width = 1), vjust = -0.05)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Cycle Inspection-1.png){width=864}\n:::\n:::\n\n\n## Pre-permit Operational\n\nSecond most considered type of inspection is Pre-permit Operational, where\nit begins from 2014. Even though in year 2014 the amounts for initial inspection\nand re-inspection are less than 20 in all three critical flag categories. \nConsidering the gap between Critical and Not Critical for initial inspection\nover the years there is a clear increase. Where as in year 2015 the gap is \nslightly less than 400, next year it is close to 1000, but by year 2018 \nthis gap is above than 2000. \n\nIn re-inspection for the year 2015 the gap is almost 150, yet with more inspections\nby 2018 the gap increases to 600. For, Not Applicable the counts do not have \na clear increasing or decreasing pattern over the years. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subsetting data \n# Specific insepction type, critical flag and year with bar plot \nsubset(NYC,inspection_type==\"Pre-permit (Operational) / Initial Inspection\" |\n           inspection_type==\"Pre-permit (Operational) / Re-inspection\") %>%\nggplot(.,aes(x=str_wrap(inspection_type,8),fill=critical_flag))+\n       geom_bar(position = \"dodge\",stat = \"count\")+\n      facet_wrap(~year(inspection_date)) +\n      xlab(\"Pre-permit (Operational)\")+\n      ylab(\"Frequency\")+\n      ggtitle(\"Pre-permit (Operational) over the years for Critical Flag\")+\n      labs(fill=\"Critical Flag\")+\n      facet_wrap(~year(inspection_date)) +\n       geom_text(stat = \"count\",aes(label=..count..),\n                 position = position_dodge(width = 1), vjust = -0.05)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Pre-permit (operational)-1.png){width=864}\n:::\n:::\n\n\n## Administrative Miscellaneous\n\nVery odd bar plot here than previous two plots for inspection types. There is no Critical type \nrestaurants in the Administrative Miscellaneous inspection type. The counts begin from \nyear 2014 but the amounts are less than 10. Clearly for initial inspections over \nthe years from 2015 to 2018 the count for Not Applicable are increasing, but this is not the \ncase for Not Critical. \n\nIn year 2015 the amount for the type Not Critical for initial inspection  was 528, but in years 2016 and 2018 \nthe amounts increased respectively to 1038 and 1486. Even though the amount decreased to 1015 in year 2017. \nThe same pattern of increase and decrease behavior occurs for Re-inspection type as well. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subsetting data \n# Specific insepction type, critical flag and year with bar plot \nsubset(NYC,inspection_type==\"Administrative Miscellaneous / Initial Inspection\" |\n           inspection_type==\"Administrative Miscellaneous / Re-inspection\") %>%\nggplot(.,aes(x=str_wrap(inspection_type,8),fill=critical_flag))+\n     geom_bar(position = \"dodge\",stat = \"count\")+\n   facet_wrap(~year(inspection_date)) +\n      xlab(\"Administrative Miscellaneous\")+\n      ylab(\"Frequency\")+\n      ggtitle(\"Administrative Miscellaneous over the years for Critical Flag\")+\n      labs(fill=\"Critical Flag\")+\n      facet_wrap(~year(inspection_date)) +\n       geom_text(stat = \"count\",aes(label=..count..),\n                 position = position_dodge(width = 1), vjust = -0.05)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Administrative Miscellaneous-1.png){width=864}\n:::\n:::\n\n\n# Most Inspected Restaurants\n\nFirst look at the top 5 restaurants which were inspected and clearly Dunkin' \nDonuts has the highest amount with 3136, while second place goes to Subway with 2419 \nand third place goes to McDonald's with 1783. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Most 5 restaurants which were inspected\nkable(summary.factor(dba) %>%\n              sort() %>%\n              tail(5)\n      ,col.names = c(\"Frequency\"),align = 'c') \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> Frequency </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> KENNEDY FRIED CHICKEN </td>\n   <td style=\"text-align:center;\"> 1031 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> STARBUCKS </td>\n   <td style=\"text-align:center;\"> 1636 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> MCDONALD'S </td>\n   <td style=\"text-align:center;\"> 1783 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SUBWAY </td>\n   <td style=\"text-align:center;\"> 2419 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> DUNKIN' DONUTS </td>\n   <td style=\"text-align:center;\"> 3136 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Dunkin Donuts\n\nQueens has close to 1000 observations of Dunkin Donuts and lowest amount\ngoes to Staten Island with 308. Other three boros have counts in between\n550 and 710. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subsetting Dunkin Donuts with boro\nsubset(NYC, dba==\"DUNKIN' DONUTS\") %>%\n  ggplot(.,aes(x=boro))+\n  geom_bar(position = \"dodge\",stat = \"count\")+\n  geom_text(stat = \"count\",aes(label=..count..), vjust = -0.05)+\n  ggtitle(\"How many Dunkin Donuts in a Boro\")+\n  xlab(\"Boro\")+ylab(\"Frequency\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Dunkin Donuts-1.png){width=70% height=70%}\n:::\n:::\n\n\nThere are only 5 cuisine types and prominent ones are American, Donuts and \ndrinks(Cafe/Coffee/Tea). Year 2014 is very low in amounts even for cuisine\nDonuts, but this is not the case over the next few years and the scores are mostly \ncentered between 5 to 15. Bagels/Pretzels and Jewish/ Kosher have least amount \nof data where none of scores are above 25. It is safe to to say we have more Critical \ntype data and they are mostly close to the score of 10. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Dunkin Donuts and scores with critical flag\nsubset(NYC, dba==\"DUNKIN' DONUTS\") %>%\nggplot(.,mapping=aes(y=score,color=critical_flag,x=factor(year(inspection_date))))+\n      geom_jitter(alpha=0.3)+labs(color=\"Critical Flag\")+    \n      ggtitle(\"Dunkin Donuts score changes with Critical Flag for Cuisines\")+\n      xlab(\"Critical Flag\")+ylab(\"Score\")+\n      scale_y_continuous(breaks = seq(0,60,5),labels =seq(0,60,5))+\n      facet_wrap(~cuisine_description) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Dunkin Donuts, score and critical flag with cuisinedescription over years-1.png){width=864}\n:::\n:::\n\n\n## Subway\n\n912 points from Manhattan with the highest count and lowest count goes to Staten Island with\n141 counts. Bronx and Brooklyn has counts in between 320 and 365, but Queens boro has an amount\nof 683. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subsetting Subway with boro\nsubset(NYC, dba==\"SUBWAY\") %>% \n  ggplot(.,aes(x=boro))+\n  geom_bar(position = \"dodge\",stat = \"count\")+\n  geom_text(stat = \"count\",aes(label=..count..), vjust = -0.05)+\n  ggtitle(\"How many Subways in Boro\")+\n  xlab(\"Boro\")+ylab(\"Frequency\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Subway-1.png){width=70% height=70%}\n:::\n:::\n\n\nSubway has only 5 cuisines which are American, Other, Sandwiches, Sandwiches/Salads/Mixed Buffet\nand Soups & Sandwiches. In these five categories only Sandwiches has significant amount of data \npoints. Oddly, we can see the year 1900 in the x axis and which means error. \n\nIn Sandwiches category there are more points which are centered in between 5 to 15 in scores, while\nmost of them are Not Critical. Oddly in 2018 there are Critical data points with scores above 55 in \nSandwiches cuisine type. \n\nFor the Other category there are only 4 observations which are in 2018 and 75% of them are Not Critical.\nConsidering American Cuisines there are points in all 4 years and most of them are less than 25% and Not \nCritical. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Subway and scores with critical flag\nsubset(NYC, dba==\"SUBWAY\") %>%\nggplot(.,mapping=aes(y=score,color=critical_flag,x=factor(year(inspection_date))))+\n      geom_jitter(alpha=0.3)+ labs(color=\"Critical Flag\")+    \n      ggtitle(\"Subway score changes with Critical Flag for Cuisines\")+\n      xlab(\"Critical Flag\")+ylab(\"Score\")+\n      scale_y_continuous(breaks = seq(0,80,5),labels =seq(0,80,5))+\n      facet_wrap(~cuisine_description) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Subway, score and critical flag with cuisine description overyears-1.png){width=864}\n:::\n:::\n\n\n## McDonalds\n\nClose to 550 data points are from Manhattan boro, but Staten Island boro has points \nclose to 75. Second place of 487 counts goes to Queens boro.  Other two boros, which\nare Bronx and Brooklyn have counts in the range of 320 and 360. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# subsetting McDonalds with boro\nsubset(NYC, dba==\"MCDONALD'S\") %>% \n  ggplot(.,aes(x=boro))+\n  geom_bar(position = \"dodge\",stat = \"count\")+\n  geom_text(stat = \"count\",aes(label=..count..), vjust = -0.05)+\n  ggtitle(\"How many McDonalds in Boro\")+\n  xlab(\"Boro\")+ylab(\"Frequency\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/McDonalds-1.png){width=70% height=70%}\n:::\n:::\n\n\nOnly the cuisines Other and Sandwiches/Salads/Mixed Buffet has data points in the years\n2017 and 2018 and these points have an amount less than 15 in both cases. Considering \nthe other two cuisines which are American and Hamburgers, there are more points in the latter\nthan in the former. It should be noted that Hamburgers cuisine has mostly points centered \nclose to the score range of 5 to 10, and these points are mostly Not Critical. \n\nIn American cuisine for the year 2016 there are 5 points which have scores close to 70, even \nthough in any other year this has not occurred. To be more precise, except those 5 points all\nthe others have scores less than 45 for American Cuisine. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# McDonalds and scores with critical flag\nsubset(NYC, dba==\"MCDONALD'S\") %>%\nggplot(.,mapping=aes(y=score,color=critical_flag,x=factor(year(inspection_date))))+\n      geom_jitter(alpha=0.3)+      \n      labs(color=\"Critical Flag\")+    \n      ggtitle(\"McDonalds score changes with Critical Flag for Cuisines\")+\n      xlab(\"Critical Flag\")+ylab(\"Score\")+\n      scale_y_continuous(breaks = seq(0,80,5),labels =seq(0,80,5))+\n      facet_wrap(~cuisine_description) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/McDonalds scores, score and critical flag with cuisinedescription over years-1.png){width=864}\n:::\n:::\n\n\n## Starbucks\n\nThere are more than 1100 Starbucks in Manhattan only while other boros have \nless than 220 and lowest amount goes to Bronx with 31. Second lowest goes to Staten\nIsland with 41. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#subsetting Starbucks with boro\nsubset(NYC, dba==\"STARBUCKS\") %>% \n  ggplot(.,aes(x=boro))+\n  geom_bar(position = \"dodge\",stat = \"count\")+\n  geom_text(stat = \"count\",aes(label=..count..), vjust = -0.05)+\n  ggtitle(\"How many Starbucks in Boro\")+\n  xlab(\"Boro\")+ylab(\"Frequency\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Starbucks-1.png){width=70% height=70%}\n:::\n:::\n\n\nStarbucks is mainly focused on Cafe/Coffee/Tea rather than cuisines such as Pizza, Sandwiches,\nAmerican and other. Clearly there are negligible amount of data points in those four\ncategories, except American cuisine. \n\nIf we focus on Drinks(Coffee/Cafe/Tea), evidently most of them are Not Critical and they\nare centered around the score of 0 to 10. Even though scores higher than 15 do occur they \nare spread out widely. This is a common occurrence for all four years, which is from 2015 to\n2018. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Starbucks and scores with critical flag\nsubset(NYC, dba==\"STARBUCKS\") %>%\nggplot(.,mapping=aes(y=score,color=critical_flag,x=factor(year(inspection_date))))+\n      geom_jitter(alpha=0.3)+\n      labs(color=\"Critical Flag\")+    \n      ggtitle(\"Starbucks score changes with Critical Flag for Cuisines\")+\n      xlab(\"Critical Flag\")+ylab(\"Score\")+\n      scale_y_continuous(breaks = seq(0,80,5),labels =seq(0,80,5))+\n      facet_wrap(~cuisine_description) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Starbucks, score and critical flag with cuisine descriptionover years-1.png){width=864}\n:::\n:::\n\n\n## Kennedy Fried Chicken\n\nBronx the has most amount observations to Kennedy Fried Chicken's with 626 while lowest\ncount of 5 is from Staten Island. Other three boros have counts in the range of 75 to 190. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#subsetting Kennedy Fried Chicken with boro\nsubset(NYC, dba==\"KENNEDY FRIED CHICKEN\") %>% \n  ggplot(.,aes(x=boro))+\n  geom_bar(position = \"dodge\",stat = \"count\")+\n  geom_text(stat = \"count\",aes(label=..count..), vjust = -0.05)+\n  ggtitle(\"How many Kennedy Fried Chicken's in Boro\")+\n  xlab(\"Boro\")+ylab(\"Frequency\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Kennedy Fried Chicken-1.png){width=70% height=70%}\n:::\n:::\n\n\nThere are only four cuisines which are related to Kennedy Fried Chicken, and they are\nAmerican, Chicken, Hamburgers and other. The categories Hamburgers and Other have very less amount\nof counts and the year 1900 is also mentioned. For Hamburgers cuisine only the year 2017 has \nsignificant amount of data points, where the year 2015 has only one and year 2018 has only two points.\n\nFurther, the scores for these points are always less than 20 and mostly Critical.\nCuisines of Chicken has more data points than American but in both types there is \nno clear centering of data around a certain score. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kennedy Fried Chicken and scores with critical flag\nsubset(NYC, dba==\"KENNEDY FRIED CHICKEN\") %>%\nggplot(.,mapping=aes(y=score,color=critical_flag,x=factor(year(inspection_date))))+\n      geom_jitter(alpha=0.3)+     \n      labs(color=\"Critical Flag\")+    \n      ggtitle(\"Kennedy Fried Chicken score changes with Critical Flag\")+\n      xlab(\"Critical Flag\")+ylab(\"Score\")+\n      scale_y_continuous(breaks = seq(0,80,5),labels =seq(0,80,5))+\n      facet_wrap(~cuisine_description) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/Kennedy Fried Chicken, score and critical flag with cuisinedescription over years-1.png){width=864}\n:::\n:::\n\n\n# Conclusion \n\nMy conclusion of the above plots and a table in point form\n\n* facet wrap is very useful.\n\n* Adding colors makes it more useful for the plots.\n\n* Generating pie chart using bar chart looks good. \n\n# Further Analysis\n\n* It is possible to focus on violation codes. \n\n* Further looking at the cuisines we can divide it based on the boros as well.\n\n*THANK YOU*\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}